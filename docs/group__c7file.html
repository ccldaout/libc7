<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libc7: c7file.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libc7
   &#160;<span id="projectnumber">r0.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">c7file.h</div>  </div>
</div><!--header-->
<div class="contents">

<p>ファイルまたはファイル名の操作  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
パス名に関する処理</h2></td></tr>
<tr class="memitem:ga5d10bd1a79d0b8391ec5281ceff95ddc"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga5d10bd1a79d0b8391ec5281ceff95ddc">c7_path_name</a> (const char *path)</td></tr>
<tr class="memdesc:ga5d10bd1a79d0b8391ec5281ceff95ddc"><td class="mdescLeft">&#160;</td><td class="mdescRight">パス名のファイル名部分を戻す。  <a href="#ga5d10bd1a79d0b8391ec5281ceff95ddc">More...</a><br /></td></tr>
<tr class="separator:ga5d10bd1a79d0b8391ec5281ceff95ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab2353a2de919656c35c3d8e7fa3b4d6d"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#gab2353a2de919656c35c3d8e7fa3b4d6d">c7_path_suffix</a> (const char *file)</td></tr>
<tr class="memdesc:gab2353a2de919656c35c3d8e7fa3b4d6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">ファイル名のサフィクスを戻す。  <a href="#gab2353a2de919656c35c3d8e7fa3b4d6d">More...</a><br /></td></tr>
<tr class="separator:gab2353a2de919656c35c3d8e7fa3b4d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7cff6ce94d1b999eef932fc745b76748"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga7cff6ce94d1b999eef932fc745b76748">c7_file_special_path</a> (<a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *sbp, const char *dir_envname_op, const char *name, const char *suffix)</td></tr>
<tr class="memdesc:ga7cff6ce94d1b999eef932fc745b76748"><td class="mdescLeft">&#160;</td><td class="mdescRight">[libc7ライブラリ向け] 特殊ファイルのパス名を決定する。  <a href="#ga7cff6ce94d1b999eef932fc745b76748">More...</a><br /></td></tr>
<tr class="separator:ga7cff6ce94d1b999eef932fc745b76748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga81a50e8afd0bf7e58df47de76e219747"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga81a50e8afd0bf7e58df47de76e219747">c7_file_search</a> (<a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *sbp, const char *name, const char **pathlistv, const char *suffix)</td></tr>
<tr class="memdesc:ga81a50e8afd0bf7e58df47de76e219747"><td class="mdescLeft">&#160;</td><td class="mdescRight">ファイルを検索リストやデフォルトサフィクスの情報に基づいて検索する。  <a href="#ga81a50e8afd0bf7e58df47de76e219747">More...</a><br /></td></tr>
<tr class="separator:ga81a50e8afd0bf7e58df47de76e219747"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
標準ライブラリ関数の特殊版</h2></td></tr>
<tr class="memitem:gab8051ee7dffffc2bb22d39f9972e9c5c"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#gab8051ee7dffffc2bb22d39f9972e9c5c">c7_fgets</a> (<a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *sbp, FILE *fp)</td></tr>
<tr class="memdesc:gab8051ee7dffffc2bb22d39f9972e9c5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">可能な限り一行分('\n')を読み込む fgets() の拡張版。  <a href="#gab8051ee7dffffc2bb22d39f9972e9c5c">More...</a><br /></td></tr>
<tr class="separator:gab8051ee7dffffc2bb22d39f9972e9c5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
ファイル単位での入出力</h2></td></tr>
<tr class="memitem:ga356e5f587c53ac9efc7a059935dfb0d2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga356e5f587c53ac9efc7a059935dfb0d2">c7_file_write</a> (const char *path, int mode, void *buf, size_t size)</td></tr>
<tr class="memdesc:ga356e5f587c53ac9efc7a059935dfb0d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">バッファの内容でファイルを書き込む。  <a href="#ga356e5f587c53ac9efc7a059935dfb0d2">More...</a><br /></td></tr>
<tr class="separator:ga356e5f587c53ac9efc7a059935dfb0d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1d01035ab495bd0a7b27d6d53d689667"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga1d01035ab495bd0a7b27d6d53d689667">c7_file_rewrite</a> (const char *path, void *buf, size_t size, const char *bck_suffix)</td></tr>
<tr class="memdesc:ga1d01035ab495bd0a7b27d6d53d689667"><td class="mdescLeft">&#160;</td><td class="mdescRight">バッファの内容でファイルを可能な限り安全に書き換える。  <a href="#ga1d01035ab495bd0a7b27d6d53d689667">More...</a><br /></td></tr>
<tr class="separator:ga1d01035ab495bd0a7b27d6d53d689667"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga39cb48eea27c3cf9ab6845ca3e314a94"><td class="memItemLeft" align="right" valign="top">ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga39cb48eea27c3cf9ab6845ca3e314a94">c7_file_read</a> (const char *path, void *buf, size_t size)</td></tr>
<tr class="memdesc:ga39cb48eea27c3cf9ab6845ca3e314a94"><td class="mdescLeft">&#160;</td><td class="mdescRight">ファイル(もしくは標準入力)から指定サイズ分のデータを読み込む。  <a href="#ga39cb48eea27c3cf9ab6845ca3e314a94">More...</a><br /></td></tr>
<tr class="separator:ga39cb48eea27c3cf9ab6845ca3e314a94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac7934b853c47a8d9a16066037864a905"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#gac7934b853c47a8d9a16066037864a905">c7_file_read_x</a> (const char *path, size_t *sizep_o)</td></tr>
<tr class="memdesc:gac7934b853c47a8d9a16066037864a905"><td class="mdescLeft">&#160;</td><td class="mdescRight">ファイル(もしくは標準入力)からEOFに到達するまで全データを読み込む。  <a href="#gac7934b853c47a8d9a16066037864a905">More...</a><br /></td></tr>
<tr class="separator:gac7934b853c47a8d9a16066037864a905"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1ef7cac89ee23d7bbdc49bb9063892b0"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga1ef7cac89ee23d7bbdc49bb9063892b0">c7_file_readlines_x</a> (const char *path, size_t *nlinep_o)</td></tr>
<tr class="memdesc:ga1ef7cac89ee23d7bbdc49bb9063892b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">テキストファイル(もしくは標準入力)から読み込んだデータを行の配列として戻す。  <a href="#ga1ef7cac89ee23d7bbdc49bb9063892b0">More...</a><br /></td></tr>
<tr class="separator:ga1ef7cac89ee23d7bbdc49bb9063892b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
ファイルの簡易 mmap インターフェース</h2></td></tr>
<tr class="memitem:gab8001f1fdc8c57d453b186bba26a3d19"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#gab8001f1fdc8c57d453b186bba26a3d19">c7_file_mmap_r</a> (const char *path, size_t *sizep_o)</td></tr>
<tr class="memdesc:gab8001f1fdc8c57d453b186bba26a3d19"><td class="mdescLeft">&#160;</td><td class="mdescRight">ファイルを読み込み専用で mmap する。  <a href="#gab8001f1fdc8c57d453b186bba26a3d19">More...</a><br /></td></tr>
<tr class="separator:gab8001f1fdc8c57d453b186bba26a3d19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7ea7ee1619a5d73d631aab70ae084cbc"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#ga7ea7ee1619a5d73d631aab70ae084cbc">c7_file_mmap_rw</a> (const char *path, size_t *sizep_io, <a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a> create)</td></tr>
<tr class="memdesc:ga7ea7ee1619a5d73d631aab70ae084cbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">ファイルを読み書き両用で mmap する。  <a href="#ga7ea7ee1619a5d73d631aab70ae084cbc">More...</a><br /></td></tr>
<tr class="separator:ga7ea7ee1619a5d73d631aab70ae084cbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa28293a7bc1e9eb6a86cc1d335b8e934"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__c7file.html#gaa28293a7bc1e9eb6a86cc1d335b8e934">c7_file_munmap</a> (void *addr, size_t size)</td></tr>
<tr class="memdesc:gaa28293a7bc1e9eb6a86cc1d335b8e934"><td class="mdescLeft">&#160;</td><td class="mdescRight">mmap したメモリを munmap する。  <a href="#gaa28293a7bc1e9eb6a86cc1d335b8e934">More...</a><br /></td></tr>
<tr class="separator:gaa28293a7bc1e9eb6a86cc1d335b8e934"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>ファイルまたはファイル名の操作 </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga5d10bd1a79d0b8391ec5281ceff95ddc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5d10bd1a79d0b8391ec5281ceff95ddc">&#9670;&nbsp;</a></span>c7_path_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* c7_path_name </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>パス名のファイル名部分を戻す。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>パス名。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>path に '/' が含まれていたら最後の '/' の直後を、そうでなければ path を戻す。 </dd></dl>

</div>
</div>
<a id="gab2353a2de919656c35c3d8e7fa3b4d6d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab2353a2de919656c35c3d8e7fa3b4d6d">&#9670;&nbsp;</a></span>c7_path_suffix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* c7_path_suffix </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ファイル名のサフィクスを戻す。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>ファイル名。ディレクトリを含んでいないことを想定している。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>file に '. ' が含まれていたら最後の '. ' の直後を、そうでなければ終端を戻す。</dd></dl>
<dl class="section note"><dt>Note</dt><dd>file にディレクトリ部分が存在し、そこに '. ' が含まれていると正しく動作しない場合がある。 </dd></dl>

</div>
</div>
<a id="ga7cff6ce94d1b999eef932fc745b76748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7cff6ce94d1b999eef932fc745b76748">&#9670;&nbsp;</a></span>c7_file_special_path()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a>* c7_file_special_path </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *&#160;</td>
          <td class="paramname"><em>sbp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir_envname_op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>[libc7ライブラリ向け] 特殊ファイルのパス名を決定する。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sbp</td><td>決定したパス名を設定するC7文字列。NULLの場合は <a class="el" href="group__c7string__strbuf.html#ga24cde018142087910bbc5c72c0e37dc1" title="C7文字列を c7_sg_malloc() で確保し、 バッファを c7_sg_realloc() で確保するように初期化してC7文字列のポインタを戻す。 メモリ確保に失敗した場合だけ C7_STR_N...">c7_str_new_sg()</a> で確保される。 </td></tr>
    <tr><td class="paramname">dir_envname_op</td><td>ディレクトリを指定する環境変数名。NULLを指定した場合は "C7_ROOT_DIR" が渡されたものとし扱われる。 </td></tr>
    <tr><td class="paramname">name</td><td>ファイル名。suffix で指定するサフィクス文字列を含んでいてもよい。 </td></tr>
    <tr><td class="paramname">suffix</td><td>サフィクス文字列。先頭文字が '. ' であることを仮定する。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>sbp が戻される。NULL が指定されていた場合は <a class="el" href="group__c7string__strbuf.html#ga24cde018142087910bbc5c72c0e37dc1" title="C7文字列を c7_sg_malloc() で確保し、 バッファを c7_sg_realloc() で確保するように初期化してC7文字列のポインタを戻す。 メモリ確保に失敗した場合だけ C7_STR_N...">c7_str_new_sg()</a> の結果が戻される。</dd></dl>
<p>パス名は以下の手順で決められる。</p><ol type="1">
<li>name の後尾が suffix と一致しなければ、name に suffix を追加したものを name として扱う。</li>
<li>name に '/' が含まれていれば、それを sbp にコピーして関数から戻る。</li>
<li>dir_envname_op が NULL でなくて、それが環境変数として定義されていたら、環境変数の値をディレクトリとする。</li>
<li>dir_envname_op が NULL の場合、C7_ROOT_DIR が環境変数として定義されていたら、その値をディレクトリとする。</li>
<li>3., 4. のいずれでもなければ "${HOME}/.c7" をディレクトリとする。</li>
<li>3., 4., 5. で決まったディレクトリが存在すれば、そのディレクトリと name を結合したものを sbp に設定して関数から戻る。</li>
<li>ディレクトリが存在しなければ、"${HOME}/." と name を結合したものを sbp に設定して関数から戻る。 </li>
</ol>

</div>
</div>
<a id="ga81a50e8afd0bf7e58df47de76e219747"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga81a50e8afd0bf7e58df47de76e219747">&#9670;&nbsp;</a></span>c7_file_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a> c7_file_search </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *&#160;</td>
          <td class="paramname"><em>sbp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>pathlistv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ファイルを検索リストやデフォルトサフィクスの情報に基づいて検索する。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sbp</td><td>検索して見つかったパス名を設定するC7文字列。NULLを指定することはできない。 </td></tr>
    <tr><td class="paramname">name</td><td>検索したいファイルの名前。 </td></tr>
    <tr><td class="paramname">pathlistv</td><td>検索パス文字列のNULL終端の配列。各 pathlistv[i] に対して <a class="el" href="group__c7string__strbuf.html#gaa67684d5e0f4ed0398538b245bef6e77" title="文字列 in に含まれる環境変数参照を評価してC7文字列 sbp に追加する。">c7_streval_env()</a> で環境変数の参照を評価し、その結果を PATH 環境変数同様 ':' で分割したものを 検索対象のディレクトリとする。 </td></tr>
    <tr><td class="paramname">suffix</td><td>name が '.' を含まない場合に追加されるサフィクス文字列。先頭文字が '.' であることを仮定する。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>存在するファイルが見つかれば C7_TRUE を戻し、そうでなれば C7_FALSE を戻す。</dd></dl>
<ol type="1">
<li>name が '.' を含まなければ name に default_suffix を追加したものを name として扱う。</li>
<li>name が '/' から始まっていれば(絶対パス)、この name でファイルの存在を確認する。 ファイルが存在すれば sbp にファイル名を設定し C7_TRUE を戻し、そうでなければ C7_FALSE を戻す。</li>
<li>pathlistv[n] が NULL となるまで n をインクリメントしながら、pathlistv[n] で決まる ディレクトリのリストを先頭から順に検索する。ファイルの存在が最初に確認されたディレクトリで、 パス名(ディレクトリ名＋name)を sbp に設定し、C7_TRUE を戻す。</li>
<li>ファイルが見つからなければ C7_FALSE を戻す。 </li>
</ol>

</div>
</div>
<a id="gab8051ee7dffffc2bb22d39f9972e9c5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab8051ee7dffffc2bb22d39f9972e9c5c">&#9670;&nbsp;</a></span>c7_fgets()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* c7_fgets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__c7string__strbuf.html#gaad0bbcb830057114f446d45e08ccf6f5">c7_str_t</a> *&#160;</td>
          <td class="paramname"><em>sbp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>fp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>可能な限り一行分('\n')を読み込む fgets() の拡張版。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sbp</td><td>C7文字列。NULLは許されない。読み込む前に sbp に含まれている内容はリセットされる。 </td></tr>
    <tr><td class="paramname">fp</td><td>読み込む FILE オブジェクト。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>正常に読み込めたら <a class="el" href="group__c7string__strbuf.html#ga347f442db207a60567666f44774ccae0" title="c7_str_buf()の別名">c7_strbuf(sbp)</a> を戻し、それ以外は NULL を戻す。 NULL が戻った場合に、エラーなのか EOF なのかは c7_status_had_error() で調べるしかない。</dd></dl>
<p>この関数は次のように動作する:</p><ul>
<li><a class="el" href="group__c7status.html#gac94f57f0ebde80d8919680d0e41d2f81" title="現スレッドのステータス情報をクリアする。">c7_status_clear()</a> でステータス情報をクリアする。</li>
<li>fgets() の結果に '\n' が含まれるまで、fgets() を繰り返し呼び出し、 sbp に読み込み結果を追加していく。</li>
<li>'\n' を読み込んだら <a class="el" href="group__c7string__strbuf.html#ga347f442db207a60567666f44774ccae0" title="c7_str_buf()の別名">c7_strbuf(sbp)</a> を戻す。</li>
<li>'\n' を読み込む前に fgets() が NULL を戻したら、sbp へ '\n' を追加して、 エラーがなければ <a class="el" href="group__c7string__strbuf.html#ga347f442db207a60567666f44774ccae0" title="c7_str_buf()の別名">c7_strbuf(sbp)</a> を戻す。</li>
<li>sbp への追加でエラーが発生したら NULL を戻す。</li>
<li>読み込みでエラーが発生した場合は <a class="el" href="group__c7status.html#ga8f081e437b82497de02ae0bebe4f8ab9" title="ステータス情報を追加する。">c7_status_add()</a> でエラーを記録し NULL を戻す。</li>
<li>EOFを検出した場合はエラーは記録せず NULL を戻す。 </li>
</ul>

</div>
</div>
<a id="ga356e5f587c53ac9efc7a059935dfb0d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga356e5f587c53ac9efc7a059935dfb0d2">&#9670;&nbsp;</a></span>c7_file_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a> c7_file_write </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>バッファの内容でファイルを書き込む。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>書き込まれるファイル名。ファイルが存在しなければ作成され、存在すれば中身はリセットされる。 </td></tr>
    <tr><td class="paramname">mode</td><td>新規作成される場合の保護モード。 </td></tr>
    <tr><td class="paramname">buf</td><td>ファイルに書き込まれる内容。 </td></tr>
    <tr><td class="paramname">size</td><td>ファイルに書き込むバイト数。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>処理に成功すれば C7_TRUE を戻し、失敗すれば C7_FALSE を戻す。 </dd></dl>

</div>
</div>
<a id="ga1d01035ab495bd0a7b27d6d53d689667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1d01035ab495bd0a7b27d6d53d689667">&#9670;&nbsp;</a></span>c7_file_rewrite()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a> c7_file_rewrite </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>bck_suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>バッファの内容でファイルを可能な限り安全に書き換える。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>書き換えの対象となるファイル名。存在しなければエラーとなる。 </td></tr>
    <tr><td class="paramname">buf</td><td>書き換え後のファイルの内容となるデータ </td></tr>
    <tr><td class="paramname">size</td><td>データbufのバイト数 </td></tr>
    <tr><td class="paramname">bck_suffix</td><td>既存ファイルをバックアップとして残す場合のサフィクス。 NULLポインタであればバックアップは残らない。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>書き換えに成功すれば C7_TRUE を戻す。失敗した場合は C7_FALSE を戻す。 その場合、ファイル path は元のままである。</dd></dl>
<p>バッファ buf の内容で一度テンポラリファイルを作成し、シグナルブロックした うえでファイルの rename を行う。bck_suffix にNULLが指定された場合であっても、 既存ファイルは一旦バックアップファイルとして rename されるため、仮に、 SIGKILL などで強制終了された場合でも、既存ファイルはバックアップ名の可能性 があるとしても存在している。 </p>

</div>
</div>
<a id="ga39cb48eea27c3cf9ab6845ca3e314a94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga39cb48eea27c3cf9ab6845ca3e314a94">&#9670;&nbsp;</a></span>c7_file_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t c7_file_read </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ファイル(もしくは標準入力)から指定サイズ分のデータを読み込む。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>読み込むファイル名。NULLポインタ、空文字列、"-" のいずれかの場合は標準入力(記述子0)から読み込む。 </td></tr>
    <tr><td class="paramname">buf</td><td>読み込んだデータを格納するバッファ。 </td></tr>
    <tr><td class="paramname">size</td><td>読み込むバイト数。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>read(2)が -1 を戻した場合は -1。それ以外は size までに未達のバイト数 (size - 読み込めたバイト数) を戻す。 </dd></dl>

</div>
</div>
<a id="gac7934b853c47a8d9a16066037864a905"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac7934b853c47a8d9a16066037864a905">&#9670;&nbsp;</a></span>c7_file_read_x()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* c7_file_read_x </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>sizep_o</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ファイル(もしくは標準入力)からEOFに到達するまで全データを読み込む。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>読み込むファイル名。NULLポインタ、空文字列、"-" のいずれかの場合は標準入力(記述子0)から読み込む。 </td></tr>
    <tr><td class="paramname">sizep_o</td><td>NULLポインタでなければ、*sizep_o に実際に読み込んだバイト数を格納する。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>read(2) や realloc(3) がエラーとなれば NULL ポインタを戻し、そうでなければ、 realloc() で確保されたバッファを戻す。このバッファは読み込んだ全データを保持するが、 テキスト処理向けに 1byte 余分に確保されており、そこには 0x0 (null character) が格納されている。 当然、sizep_o に戻すバイト数に、この余分は含まれていない。 </dd></dl>

</div>
</div>
<a id="ga1ef7cac89ee23d7bbdc49bb9063892b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1ef7cac89ee23d7bbdc49bb9063892b0">&#9670;&nbsp;</a></span>c7_file_readlines_x()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** c7_file_readlines_x </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>nlinep_o</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>テキストファイル(もしくは標準入力)から読み込んだデータを行の配列として戻す。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>読み込むファイル名。NULLポインタ、空文字列、"-" のいずれかの場合は標準入力(記述子0)から読み込む。 </td></tr>
    <tr><td class="paramname">nlinep_o</td><td>NULLポインタでなければ *nlinep_o に行数を格納する。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>処理に失敗するとNULLポインタを戻し、 成功した場合はファイルの内容を1行毎('\n'で)の文字列に分割した配列として戻す。 この配列を strv として、読み込んだ行数を n とすると、strv[n] には NULL ポインタが設定されている。 strv[0]〜strv[n-2] までの文字列には '\n' が存在するが、最終行である strv[n-1] に '\n' が あるかどうかは元データによる。<br />
 データが不要になった場合は、strv を free しなければならない。 free は返却値に対してのみ行い、各 strv[i] に対して行ってはならない。 </dd></dl>

</div>
</div>
<a id="gab8001f1fdc8c57d453b186bba26a3d19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab8001f1fdc8c57d453b186bba26a3d19">&#9670;&nbsp;</a></span>c7_file_mmap_r()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* c7_file_mmap_r </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>sizep_o</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ファイルを読み込み専用で mmap する。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>mmapするファイル名。存在する必要がある。 </td></tr>
    <tr><td class="paramname">sizep_o</td><td>NULLの場合、mmapするサイズをファイルのサイズから自動的に得る。 *sizep_o が 0 の場合、mmapするサイズをファイルのサイズから自動的に得て、*sizep_o にその値を格納する。 *sizep_o が 0 でなければ、それを mmapするサイズとする。*sizep_o に指定した値が実際のファイルサイズよりも大きい場合、ファイルサイズの拡張(ftruncate)が試みられる。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功すれば mmap したアドレスを戻し、失敗すれば NULL を戻す((void*)-1 ではない)。 失敗するとすれば、open(2), fstat(2), ftruncate(2), mmap(2) のいずれかで発生する。 </dd></dl>

</div>
</div>
<a id="ga7ea7ee1619a5d73d631aab70ae084cbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7ea7ee1619a5d73d631aab70ae084cbc">&#9670;&nbsp;</a></span>c7_file_mmap_rw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* c7_file_mmap_rw </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>sizep_io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__c7types.html#ga32dffe853a91b70665fd4c3b18a9d288">c7_bool_t</a>&#160;</td>
          <td class="paramname"><em>create</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ファイルを読み書き両用で mmap する。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>mmapするファイル名。 </td></tr>
    <tr><td class="paramname">sizep_io</td><td>NULLの場合、mmapするサイズをファイルのサイズから自動的に得る。 *sizep_io が 0 の場合、mmapするサイズをファイルのサイズから自動的に得て、*sizep_io にその値を格納する。 *sizep_io が 0 でなければ、それを mmapするサイズとする。*sizep_io に指定した値が実際のファイルサイズよりも大きい場合、ファイルサイズの拡張(ftruncate)が試みられる。 </td></tr>
    <tr><td class="paramname">create</td><td>ファイル path が存在しない場合に作成するかどうかを指定する。 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>成功すれば mmap したアドレスを戻し、失敗すれば NULL を戻す((void*)-1 ではない)。 失敗するとすれば、open(2), fstat(2), ftruncate(2), mmap(2) のいずれかで発生する。</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>ファイルが存在しない時に sizep_io にNULLポインタ、あるいは *sizep_io が 0 の場合、 ファイルが新規作成されたとしてもサイズが 0 のため mmap が失敗するだろう。 </dd></dl>

</div>
</div>
<a id="gaa28293a7bc1e9eb6a86cc1d335b8e934"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa28293a7bc1e9eb6a86cc1d335b8e934">&#9670;&nbsp;</a></span>c7_file_munmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void c7_file_munmap </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>mmap したメモリを munmap する。 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">addr</td><td>c7_file?mmap_r() や <a class="el" href="group__c7file.html#ga7ea7ee1619a5d73d631aab70ae084cbc" title="ファイルを読み書き両用で mmap する。">c7_file_mmap_rw()</a> の戻り値。 </td></tr>
    <tr><td class="paramname">size</td><td>addr に mmap されたバイト数。 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
